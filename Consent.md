# Consent APIs

## Flow Diagram
![alt text](https://github.com/EzyReach/api-doc/blob/consent-api/Consent%20Flow%20Diagram.PNG "Consent API")

# 1.Consent Handle Request
   HTTP Verb - POST
   ## API Endpoint - /v3/consent/consentHandleRequest

   This API is used to request the lenders to send a consent request for fetching the bank account statements, GST historical data. The lender (FIU) checks with the AA and     
   creates a consent handle internally once this API is triggered

   ## Request Payload

   |Key               |Type    |Validations |Mandatory |Description|
   |------------------|:------:|:----------:|:--------:|----------:|
   |metadata          |Metadata|            |Yes       |Metadata specific to each API response.|
   |loanApplicationIds|Array Alphanumeric |Ids are of length 35 each|Yes|UUID for the loan applications,Generated by LSP.   These are the list of loan Applications for which borrower wants consents to be created.|
   |requestId|Alphanumeric|Length 35|Yes|UUID used to tie request and response and for idempotency.|
   |consent|Consent||Yes|This includes the consent details needed for the loan.|
   
   ## Response payload
   
   |Key               |Type    |Validations |Mandatory |Description|
   |----|:----:|:----------:|:--------:|----------:|
   |ack |ACK   |            |Yes       |Acknowledgement block indicating the receipt and status of request|
   
   ## Sample Request Json
   
   ``` {
   "metadata": {
       "version": "1.0",
       "timestamp": "2020-12-01T11:39:57.153Z",
       "traceId": "e8cc6822bd4bbb4eb1b9e1b4996fbff8acb",
       "orgId": "LSP123"
   },
   "loanApplicationIds": [
       "f8cc6822bd4bbb4eb1b9e1b4996fbff8acb"
   ],
   "requestId": "g8cc6822bd4bbb4eb1b9e1b4996fbff8acb",
   "consent": {
       "consentFetchType": "ONETIME",
       "vua": "user@aa.in",
       "isAggregationEnabled": true,
       "consentAggregationId": "e8cc6822bd4bbb4eb1b9e1b4996fbff8acd",
       "lspInfo": {
           "lspId": "<AA can identify the LSP based on this>",
           "version": "<version of LSP>",
           "appName": "<Package name of the app>"
       }
   }
} 
```

## Sample Response Json
```
{
  "ack": {
    "error": "0",
    "traceId": "h8cc6822bd4bbb4eb1b9e1b4996fbff8acb",
    "timestamp": "2020-12-01T11:39:57.153Z"
  }
}
```

# 2.Consent Handle Response
  HTTP Verb - POST
  ## API Endpoint - /v3/consent/consentHandleResponse

 This API is invoked by the lenders to send the consent handles created in the AA system as part of the Consent Handle Request API triggered by the LSP.

# 3.Consent Status Request
   HTTP Verb - POST
   ## API Endpoint - /v3/consent/consentStatusReques
   
   This API is invoked by the LSP to check the status of Consents.
   
   ## Request Payload

   |Key               |Type    |Validations |Mandatory |Description|
   |------------------|:------:|:----------:|:--------:|----------:|
   |metadata          |Metadata|            |Yes       |Metadata specific to each API response.|
   |requestId|Alphanumeric|Length 35|Yes|UUID used to tie request and response and for idempotency.|
   |consent|Consent||Yes|This includes the consent details needed for the loan.|
   
   ## Response payload
   
   |Key               |Type    |Validations |Mandatory |Description|
   |----|:----:|:----------:|:--------:|----------:|
   |ack |ACK   |            |Yes       |Acknowledgement block indicating the receipt and status of request|



## Sample Request Json
   
   ``` {
   "metadata": {
       "version": "1.0",
       "timestamp": "2020-12-01T11:39:57.153Z",
       "traceId": "l8cc6822bd4bbb4eb1b9e1b4996fbff8acb",
       "orgId": "LSP123"
   },
   "requestId": "m8cc6822bd4bbb4eb1b9e1b4996fbff8acb",
   "consent": {
       "consentHandle": "m8cc6822bd4bbb4eb1b9e1b4996fbff8acb"
   }
} 
```

## Sample Response Json
```
{
  "ack": {
    "error": "0",
    "traceId": "n8cc6822bd4bbb4eb1b9e1b4996fbff8acb",
    "timestamp": "2020-12-01T11:39:57.153Z"
  }
}
```


# 4. Consent Status Response
   HTTP Verb - POST
   ## API Endpoint - /v3/consent/consentStatusResponse

This API is invoked by the lender as a response informing the LSP regarding the status of the consents.

## Non Functional Requirements
|API|SLA(seconds)|Timeout (seconds)|Throughput|
|---|------------|-----------------|----------|
|consentHandleRequest - consentHandleResponse|<2|4|100 Tps|
|consentStatusRequest - consentStatusResponse|<2|4|100 Tps|
